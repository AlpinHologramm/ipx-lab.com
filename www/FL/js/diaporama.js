/**
 * Gestion complète du diaporama.
 *
 * @license http://www.gnu.org/licenses/gpl.html
 * @link http://www.igalerie.org/
 */
function Diaporama()
{
	// Activer les animations par défaut ?
	this.animate = true;

	// Durée d'affichage par défaut d'une image en lecture automatique.
	// En secondes.
	this.autoDuration = 3.0;

	// Durée d'affichage minimale des images en lecture automatique.
	// En secondes.
	this.autoDurationMin = 1;

	// Durée d'affichage maximale des images en lecture automatique.
	// En secondes.
	this.autoDurationMax = 60;

	// Précision pour la durée d'affichage des images en lecture automatique.
	// En secondes.
	this.autoDurationPrecision = 0.5;

	// En lecture automatique, recommencer la lecture depuis
	// la première image lorsqu'on est arrivé à la dernière ?
	this.autoLoop = false;

	// Démarrer la lecture automatique au lancement du diaporama ?
	this.autoStart = false;

	// Afficher par défaut le carrousel ?
	this.carousel = true;

	// Épaisseur de la bordure du haut du carrousel.
	this.carouselBorderTop = 2;

	// Durée de l'effet de transition entre les pages du carrousel.
	this.carouselNavDuration = 600;

	// Marge externe des vignettes du carrousel.
	this.carouselThumbsMargin = 8;

	// Épaisseur de la bordure des vignettes du carrousel.
	this.carouselThumbsBorder = 1;

	// Dimensions des vignettes du carrousel.
	// En pixels (valeur minimale: 50).
	this.carouselThumbsSize = 80;

	// Durée de temporisation, en millisecondes, avant la création
	// de chaque image préchargée au lancement du diaporama.
	// Plus le paramètre MySQL 'max_user_connections' est petit,
	// plus cette durée doit être grande.
	// Si 'max_user_connections' est à 0,
	// alors 'createImageTempTime' peut être à 0.
	this.createImageTempTime = 400;

	// Cacher les barres de contrôle par défaut ?
	this.hideControlBars = false;

	// Durée de l'effet de redimensionnement de l'image
	// pour le switch taille réelle / taille redimensionnée.
	// 0 pour désactiver l'animation.
	// En millisecondes.
	this.imageResizeDuration = 250;

	// Autoriser la navigation au clavier ?
	this.keyboardNav = true;

	// Nombre d'images autour de l'image courante
	// (premières, précédentes, suivantes, dernières)
	// à récupérer depuis diaporama.php.
	this.preload = 2;

	// La sidebar doit-elle ne pas masquer l'image ?
	this.sidebarImageResize = true;

	// Durée de l'effet d'apparition des sidebars.
	// 0 pour désactiver l'animation.
	// En millisecondes.
	this.sidebarShowDuration = 250;

	// Durée de l'effet de transition entre images par défaut.
	// En millisecondes.
	this.transitionDuration = 500;

	// Effet de transition entre images par défaut.
	this.transitionEffect = 'fade';



	// Code minifié avec http://jscompress.com/
	this._anticsrf;this._autoDurationMouseDown=false;this._autoTimer;this._carouselAnimation=false;this._carouselCurrentPage=0;this._carouselCurrentPosition=1;this._carouselImages;this._carouselMaxThumbs=0;this._carouselMaxPosition=0;this._carouselNbPages=0;this._controlBarsAnimation=false;this._controlBarsOver=false;this._currentPosition;this._imageTransitionLock=false;this._images={};this._init=false;this._keyboardActive=true;this._nbImages=0;this._prevDiaporamaSize;this._q;this._realsize=false;this._sidebarMoveLock=false;this.start=function(e,t){var n=this;if(e===""){return}if(typeof t=="object"){for(option in t){if(this[option]!==undefined&&option.substr(1,1)!="_"){this[option]=t[option]}}}if(this._q===undefined){this._q=e}$("html,body").css("overflow","hidden");$("#igalerie_gallery").hide();if(this._init){if(this._q!=e){var r=e.match(/position\/(\d+)/);this._currentPosition=parseInt(r[1]);this._images={};this._nbImages=0;this._deleteImages(true);this._realsize=false;$("#diaporama_icon_switch img").attr("src",$("#diaporama_icon_switch img").attr("src").replace(/noresize(-grey)?\.png$/,"resize$1.png"));this._q=e;this._getImages(true)}$("#diaporama").show();this._changeDiaporamaSize();this._changeImageSizePosition(this._currentPosition,false,true);this._keyboardActive=true;this._keyboard();return}this._options();$(window).resize(function(){n._resize()});this._downloadImage();this._sidebarsEvents();this._favoritesBasketEvents();this._closeDiaporama();this._getImages(true);this._autoAddDuration();$("#diaporama").show();this._bars();this._changeDiaporamaSize();this._changeLoadingPosition(0,true);this._prevDiaporamaSize=this._getDiaporamaSize();var r=n._q.match(/position\/(\d+)/);this._currentPosition=parseInt(r[1]);this._keyboard();this._autoEvents();this._editSidebar();this._init=true};this._alertError=function(e){if(e==""){e="unknown error."}else if(e.length>500){e=e.slice(0,500)+"..."}alert("Error: "+e)};this._autoAddDuration=function(){var e=this.autoDuration.toString();if(!e.match(/\./)){e+=".0"}$("#diaporama_seconds").text(e+" s")};this._autoChangeDuration=function(e,t){var n=this;if(!this._autoDurationMouseDown){return}t=!t?170:t>20?t-5:t;if(this.autoDuration+e>=this.autoDurationMin&&this.autoDuration+e<=this.autoDurationMax){this.autoDuration=Math.round((this.autoDuration+e)*10)/10;this._autoAddDuration();setTimeout(function(){n._autoChangeDuration(e,t)},t)}this._savePrefs()};this._autoChangeImage=function(e){var t=this;if($("#diaporama_icon_stop img").attr("src").match(/stop-active\.png$/)){return}if(!e){if(this._currentPosition!=this._nbImages){this._changeImage($("#diaporama_icon_next"))}else if(this.autoLoop){this._changeImage($("#diaporama_icon_first"))}}var n="#diaporama_image_"+this._currentPosition;var r=function(){$("#diaporama_loading").css("visibility","hidden");var n=t.transitionEffect!="none"&&!e?parseInt(t.transitionDuration):0;t._autoTimer=setTimeout(function(){t._autoChangeImage()},t.autoDuration*1e3+n)};if($.browser.msie){var i=$(n).attr("src");$(n).attr("src","");$(n).attr("src",i)}$("#diaporama_loading").css("visibility","visible");$(n).one("load",function(){r()}).each(function(){if(this.complete||this.readyState==4||this.readyState=="complete"){$(this).trigger("load")}})};this._autoEvents=function(){var e=this;var t;$(".diaporama_messages").css("opacity",.9);$("#diaporama_icon_start").click(function(){if($("#diaporama_icon_start img").attr("src").match(/start-active\.png$/)){return}if(e._nbImages<2){return}if(e._currentPosition==e._nbImages&&!e.autoLoop){return}$("#diaporama_icon_start img").attr("src",$("#diaporama_icon_start img").attr("src").replace(/start\.png$/,"start-active.png"));$("#diaporama_icon_stop img").attr("src",$("#diaporama_icon_stop img").attr("src").replace(/stop-active\.png$/,"stop.png"));clearTimeout(t);$("#diaporama_msg_stop").css("visibility","hidden");$("#diaporama_msg_play").css("visibility","visible").fadeIn(1e3,function(){t=setTimeout(function(){$("#diaporama_msg_play").fadeOut(1e3)},2e3)});e._autoChangeImage(true)});$("#diaporama_icon_stop").click(function(){if($("#diaporama_icon_stop img").attr("src").match(/stop-active\.png$/)){return}clearTimeout(e._autoTimer);e._autoTimer=undefined;clearTimeout(t);$("#diaporama_msg_play").css("visibility","hidden");$("#diaporama_msg_stop").css("visibility","visible").fadeIn(1e3,function(){t=setTimeout(function(){$("#diaporama_msg_stop").fadeOut(1e3)},2e3)});$("#diaporama_icon_stop img").attr("src",$("#diaporama_icon_stop img").attr("src").replace(/stop\.png$/,"stop-active.png"));$("#diaporama_icon_start img").attr("src",$("#diaporama_icon_start img").attr("src").replace(/start-active\.png$/,"start.png"))});$("#diaporama_icon_more").mousedown(function(){e._autoDurationMouseDown=true;e._autoChangeDuration(e.autoDurationPrecision)}).mouseup(function(){e._autoDurationMouseDown=false}).focus(function(){$("#diaporama_icon_more").trigger("mouseover")}).blur(function(){$("#diaporama_icon_more").trigger("mouseout")}).mouseover(function(){$(this).find("img").attr("src",$(this).find("img").attr("src").replace(/more\.png$/,"more-hover.png"))}).mouseout(function(){$(this).find("img").attr("src",$(this).find("img").attr("src").replace(/more-hover\.png$/,"more.png"))});$("#diaporama_icon_less").mousedown(function(){e._autoDurationMouseDown=true;e._autoChangeDuration(-e.autoDurationPrecision)}).mouseup(function(){e._autoDurationMouseDown=false}).focus(function(){$("#diaporama_icon_less").trigger("mouseover")}).blur(function(){$("#diaporama_icon_less").trigger("mouseout")}).mouseover(function(){$(this).find("img").attr("src",$(this).find("img").attr("src").replace(/less\.png$/,"less-hover.png"))}).mouseout(function(){$(this).find("img").attr("src",$(this).find("img").attr("src").replace(/less-hover\.png$/,"less.png"))})};this._bars=function(e){var t=this;var n;var r,i;if(this.hideControlBars){$(".diaporama_bar,#diaporama_carousel").hide()}$("#diaporama").mousemove(function(e){if(!t.hideControlBars||t._isSidebarVisible()||t._controlBarsOver||t._controlBarsAnimation||r==e.pageX&&i==e.pageY){return}clearTimeout(n);r=e.pageX;i=e.pageY;var s=500;t._controlBarsAnimation=true;setTimeout(function(){t._controlBarsAnimation=false},s);$(".diaporama_bar"+(t.carousel?",#diaporama_carousel":"")).fadeIn(s);if(t.carousel){t._changeCarouselSizePosition()}n=setTimeout(function(){if(t.hideControlBars&&!t._isSidebarVisible()&&!t._controlBarsOver){var e=1e3;t._controlBarsAnimation=true;setTimeout(function(){t._controlBarsAnimation=false},e);$(".diaporama_bar,#diaporama_carousel").fadeOut(e)}},1500)});$(".diaporama_bar,#diaporama_carousel").mouseover(function(){t._controlBarsOver=true}).mouseout(function(){t._controlBarsOver=false})};this._changeDiaporamaSize=function(){$("#diaporama").css({height:$(window).height()+"px",width:$(window).width()+"px"});$(".diaporama_sidebar").css({height:$(window).height()-$("#diaporama_top").height()-$("#diaporama_bottom").height()+"px"});this._changeCarouselSizePosition();this._changeLoadingPosition()};this._changeImage=function(e,t){var n=this;var r;e=$(e).attr("id").replace(/diaporama_icon_/,"");switch(e){case"first":r=1;break;case"prev":r=this._currentPosition-1;break;case"next":r=this._currentPosition+1;break;case"last":r=this._nbImages;break}if(!$("#diaporama_image_"+r).is("img")||r<1||r>this._nbImages||this._imageTransitionLock||this._sidebarMoveLock){return}this._realsize=false;$("#diaporama_icon_switch img").attr("src",$("#diaporama_icon_switch img").attr("src").replace(/noresize(-grey)?\.png$/,"resize$1.png"));this._changeImageSizePosition(r);var i=this._currentPosition;this._currentPosition=r;this._transition(i,r,e);this._q=this._q.replace(/position\/\d+$/,"position/"+r);if(this.transitionEffect=="none"){this._getImages()}else{setTimeout(function(){n._getImages()},this.transitionDuration)}this._changeNavigationButtons();this._changeSwitchButton();if(typeof this._autoTimer=="number"&&r==this._nbImages&&!this.autoLoop){$("#diaporama_icon_stop").trigger("click")}if(t&&typeof this._autoTimer=="number"){clearTimeout(this._autoTimer);this._autoTimer=undefined;this._autoChangeImage(true)}};this._changeImageInfos=function(){if(this._images[this._currentPosition]===undefined){return}$("#diaporama_image_position").text(this._images[this._currentPosition].current_image);$("#diaporama_top_left").html(this._images[this._currentPosition].image_position);var e=this._images[this._currentPosition];var n=e.infos;if(n.desc.title===undefined){$("#diaporama_sidebar_desc").hide();$("#diaporama_sidebar_desc .diaporama_sidebar_title2 span").empty()}else{$("#diaporama_sidebar_desc").show();$("#diaporama_sidebar_desc .diaporama_sidebar_title2 span").text(n.desc.title);$("#diaporama_sidebar_desc .diaporama_sidebar_content p").html(n.desc.content)}if(n.stats.title===undefined){$("#diaporama_sidebar_stats").hide();$("#diaporama_sidebar_stats .diaporama_sidebar_title2 span").empty();$("#diaporama_sidebar_stats .diaporama_sidebar_content").empty()}else{$("#diaporama_sidebar_stats").show();$("#diaporama_sidebar_stats .diaporama_sidebar_title2 span").text(n.stats.title);var r="<ul>";for(stat in n.stats.items){r+="<li>"+n.stats.items[stat]+"</li>"}r+="</ul>";$("#diaporama_sidebar_stats .diaporama_sidebar_content").html(r)}if(n.tags.title===undefined){$("#diaporama_sidebar_tags").hide();$("#diaporama_sidebar_tags .diaporama_sidebar_title2 span").empty();$("#diaporama_sidebar_tags .diaporama_sidebar_content").empty()}else{$("#diaporama_sidebar_tags").show();$("#diaporama_sidebar_tags .diaporama_sidebar_title2 span").text(n.tags.title);var r="<ul>";for(t in n.tags.items){r+='<li class="icon icon_tag"><a href="'+n.tags.items[t].tag_link+'">'+n.tags.items[t].tag_name+"</a></li>"+"\n"}r+="</ul>";$("#diaporama_sidebar_tags .diaporama_sidebar_content").html(r)}var i=["exif","iptc","xmp"];for(meta in i){if(n[i[meta]].title===undefined){$("#diaporama_sidebar_"+i[meta]).hide();$("#diaporama_sidebar_"+i[meta]+" .diaporama_sidebar_title2 span").empty();$("#diaporama_sidebar_"+i[meta]+" .diaporama_sidebar_content").empty()}else{$("#diaporama_sidebar_"+i[meta]).show();$("#diaporama_sidebar_"+i[meta]+" .diaporama_sidebar_title2 span").text(n[i[meta]].title);var r="<ul>";for(data in n[i[meta]].items){r+="<li><span>"+n[i[meta]].items[data].name+"</span> : "+n[i[meta]].items[data].value+"</li>"}r+="</ul>";$("#diaporama_sidebar_"+i[meta]+" .diaporama_sidebar_content").html(r)}}if($("#diaporama_edit").is("div")){$("#diaporama_edit_urlname").val(e.image_url);$("#diaporama_edit_langs_select option").each(function(){$("#diaporama").append('<textarea style="display:none" id="diaporama_tatemp">'+e.locale.title[$(this).val()]+"</textarea>");$("#diaporama_edit_title_"+$(this).val()).val($("#diaporama_tatemp").val());$("#diaporama_tatemp").remove();if(e.locale.desc[$(this).val()]===null){$("#diaporama_edit_description_"+$(this).val()).val("")}else{$("#diaporama").append('<textarea style="display:none" id="diaporama_tatemp">'+e.locale.desc[$(this).val()]+"</textarea>");$("#diaporama_edit_description_"+$(this).val()).val($("#diaporama_tatemp").val());$("#diaporama_tatemp").remove()}});if(n.tags.title===undefined){$("#diaporama_edit_tags").val("")}else{var s=new Array;for(var o=0;o<n.tags.items.length;o++){s[o]=n.tags.items[o].tag_name}$("#diaporama").append('<textarea style="display:none" id="diaporama_tatemp">'+s.join(", ")+"</textarea>");$("#diaporama_edit_tags").val($("#diaporama_tatemp").val());$("#diaporama_tatemp").remove()}if(this._images[this._currentPosition].perm_edit==1){$("#diaporama_edit").removeClass("diaporama_disabled");$("#diaporama_edit input,#diaporama_edit textarea,#diaporama_edit select").removeAttr("disabled")}else{$("#diaporama_edit").addClass("diaporama_disabled");$("#diaporama_edit input,#diaporama_edit textarea,#diaporama_edit select").attr("disabled","disabled")}}if($("#diaporama_icon_fav").is("a")){var u=$("#diaporama_icon_fav img").attr("src").replace(/(-active)?.png$/,"");if(this._images[this._currentPosition].in_favorites){u+="-active.png";$("#diaporama_icon_fav").attr("title",diaporama_fav_del)}else{u+=".png";$("#diaporama_icon_fav").attr("title",diaporama_fav_add)}$("#diaporama_icon_fav img").attr("src",u)}if($("#diaporama_icon_basket").is("a")){var u=$("#diaporama_icon_basket img").attr("src").replace(/(-active)?.png$/,"");if(this._images[this._currentPosition].in_basket){u+="-active.png";$("#diaporama_icon_basket").attr("title",diaporama_basket_del)}else{u+=".png";$("#diaporama_icon_basket").attr("title",diaporama_basket_add)}$("#diaporama_icon_basket img").attr("src",u)}this._changeCarouselCurrent()};this._changeImageSizePosition=function(e,t,n,r,i){this._changeLoadingPosition(i);if(this._images[e]===undefined||!$("#diaporama_image_"+e).is("img")){return}var s=this._getDiaporamaSize();s.availableWidth+=i?i:0;var o=this._images[e].image_width/s.availableWidth;var u=this._images[e].image_height/s.availableHeight;var a=this._images[e].image_width;var f=this._images[e].image_height;var l=a;var c=f;if(!this._realsize){if(a>s.availableWidth&&o>=u){l=s.availableWidth;c=f/o}if(f>s.availableHeight&&u>=o){l=a/u;c=s.availableHeight}}var h=$("#diaporama_image_"+e).offset();var p=$("#diaporama_image_"+e).offset();if(l<=s.availableWidth||l!=$("#diaporama_image_"+e).width()){h.left=(s.availableWidth-l)/2}else if(l>s.availableWidth&&s.availableWidth!=this._prevDiaporamaSize.availableWidth){h.left+=(s.availableWidth-this._prevDiaporamaSize.availableWidth)/2;var d=l-s.availableWidth+h.left;if(d<0){h.left-=d}if(h.left>0){h.left=0}h.left=h.left}if(c<=s.availableHeight||c!=$("#diaporama_image_"+e).height()){h.top=(s.availableHeight-c)/2+s.barTopHeight}else if(c>s.availableHeight&&s.availableHeight!=this._prevDiaporamaSize.availableHeight){h.top+=(s.availableHeight-this._prevDiaporamaSize.availableHeight)/2;var v=c-(s.availableHeight+s.barBottomHeight+s.carouselHeight)+h.top;if(v<0){h.top-=v}if(h.top>s.barTopHeight){h.top=s.barTopHeight}h.top=h.top}var m={top:Math.round(h.top)+"px",left:Math.round(h.left)+"px",width:Math.round(l)+"px",height:Math.round(c)+"px"};if(!r){if(t&&$("#diaporama_image_"+e).is(":visible")&&this.imageResizeDuration>0&&this.animate){$("#diaporama_image_"+e).animate(m,this.imageResizeDuration)}else{$("#diaporama_image_"+e).css(m)}}if(n){$("#diaporama_image_"+e).show()}if(no_right_click){$("#diaporama_image_"+e).bind("contextmenu",function(){return false})}if(r){return m}if(e==this._currentPosition){this._changeSwitchButton()}};this._changeLoadingPosition=function(e,t){var n=this._getDiaporamaSize();n.availableWidth+=e?e:0;$("#diaporama_loading").css({top:(n.availableHeight-$("#diaporama_loading").height())/2+n.barTopHeight+"px",left:(n.availableWidth-$("#diaporama_loading").width())/2+"px"});if(t){var r=(new Spinner({lines:8,length:0,width:16,radius:18,corners:1,rotate:0,color:"#fff",speed:1,trail:60,shadow:false})).spin(document.getElementById("diaporama_loading"))}};this._changeNavigationButtons=function(){var e=this;var t={first:1,prev:this._currentPosition<=2?1:this._currentPosition-1,next:this._currentPosition>=this._nbImages?this._nbImages:this._currentPosition+1,last:this._nbImages};for(button in t){var n="#diaporama_icon_"+button;var r=new RegExp(button+"(?:-hover|-grey)?.png$");$(n).unbind();if(this._images[t[button]]===undefined||this._currentPosition==t[button]){$(n+" img").attr("src",$(n+" img").attr("src").replace(r,button+"-grey.png"));$(n).removeAttr("href").css({cursor:"default"})}else{if($(n+" img").attr("src").match(/-grey.png$/)){$(n+" img").attr("src",$(n+" img").attr("src").replace(r,button+".png"))}$(n).css({cursor:"pointer"}).focus(function(){$(this).trigger("mouseover")}).blur(function(){$(this).trigger("mouseout")}).mouseover(function(){var e=$(this).attr("id").replace(/diaporama_icon_/,"");$(this).find("img").attr("src",$(this).find("img").attr("src").replace(e+".png",e+"-hover.png"))}).mouseout(function(){var e=$(this).attr("id").replace(/diaporama_icon_/,"");$(this).find("img").attr("src",$(this).find("img").attr("src").replace(e+"-hover.png",e+".png"))}).click(function(){e._changeImage(this,true)})}}};this._changeSwitchButton=function(){var e=this;if(this._images[this._currentPosition]===undefined){return}var t=this._getDiaporamaSize();$("#diaporama_icon_switch").unbind("click");if(this._images[this._currentPosition].image_width>t.availableWidth||this._images[this._currentPosition].image_height>t.availableHeight){$("#diaporama_icon_switch").click(function(){e._realsize=!e._realsize;e._changeImageSizePosition(e._currentPosition,true)});var n=this._realsize?"no":"";$("#diaporama_icon_switch img").attr("src",$("#diaporama_icon_switch img").attr("src").replace(/(no)?resize(-grey)?\.png$/,n+"resize.png")).css({cursor:"pointer"})}else{$("#diaporama_icon_switch").removeAttr("href");$("#diaporama_icon_switch img").attr("src",$("#diaporama_icon_switch img").attr("src").replace(/(no)?resize(-grey)?\.png$/,"resize-grey.png")).css({cursor:"default"})}this._imageMouseDown()};this._closeDiaporama=function(){var e=this;$("#diaporama_icon_close").click(function(){e._keyboardActive=false;$("html").css("overflow","auto");$("body").css("overflow","auto");$("#diaporama_icon_stop").trigger("click");$(".diaporama_messages").stop().hide();$("#diaporama_edit .message").hide();$("#igalerie_gallery").show();$("#diaporama").hide();$("#diaporama_image_"+e._currentPosition).hide()})};this._createImage=function(e){if(this._images[e]===undefined||$("#diaporama_image_"+e).is("img")){return}$("#diaporama").append('<img class="diaporama_image" id="diaporama_image_'+e+'" style="display:none;" src="'+this._images[e].image_src+'" alt="" />');if($.browser.mozilla){$("#diaporama_image_"+e).css("outline","1px solid transparent")}if(e==this._currentPosition){if($.browser.msie){$("#diaporama_loading").css("visibility","hidden")}else{$("#diaporama_image_"+this._currentPosition).one("load",function(){$("#diaporama_loading").css("visibility","hidden")}).each(function(){if(this.complete){$(this).trigger("load")}})}}};this._deleteImages=function(e){var t=this;$(".diaporama_image").each(function(){var n=$(this).attr("id").replace(/diaporama_image_/,"");if(t._images[n]===undefined||e){$(this).remove()}})};this._dragImage=function(e,t){var n=this._getDiaporamaSize();var r=e.offsetLeft;var i=e.offsetTop;var s=t.pageX;var o=t.pageY;$(document).mousemove(function(t){var u=t.pageX;var a=t.pageY;r+=u-s;i+=a-o;s=u;o=a;if($(e).width()>n.availableWidth){if(r>0){r=0}else if(r<n.availableWidth-$(e).width()){r=n.availableWidth-$(e).width()}}else{r=$(e).css("left")}if($(e).height()>n.availableHeight){if(i>n.barTopHeight){i=n.barTopHeight}else if(i<$(window).height()-n.barBottomHeight-n.carouselHeight-$(e).height()-n.imageBorderHeight){i=$(window).height()-n.barBottomHeight-n.carouselHeight-$(e).height()-n.imageBorderHeight}}else{i=$(e).css("top")}$(e).css({left:r+"px",top:i+"px"});return false});$(document).mouseup(function(){$(document).unbind("mousemove mouseup");return false});return false};this._editSidebar=function(){if(!$("#diaporama_edit").is("div")){return}var e=this;var t;var n=function(e){$("#diaporama_edit .message").hide();$("#diaporama_edit .message_error span").text(e);$("#diaporama_edit .message_error").show();t=setTimeout(function(){$("#diaporama_edit .message_error").hide()},4e3)};var r=function(){$("#diaporama_edit .message_success").show();t=setTimeout(function(){$("#diaporama_edit .message_success").hide()},3e3)};$("#diaporama_edit_langs select").change(function(){var e=$(this).find(":selected").val();$("#diaporama_edit label.icon_lang").parents("p").hide();$("#diaporama_edit label.icon_"+e).parents("p").show()});$("#diaporama_edit form").submit(function(){return false});$("#diaporama_edit input.submit").click(function(){var i=$("#diaporama_edit form").serialize();var s=$("#diaporama_edit_tags").val();var o=$("#diaporama_edit_urlname").val();clearTimeout(t);$("#diaporama_edit .message").hide();$("#diaporama_edit_loading").show();$("#diaporama_edit input").attr("disabled","disabled");$("#diaporama_edit textarea").attr("disabled","disabled");$.post(gallery_path+"/ajax.php",{section:"edit-image",id:e._images[e._currentPosition].image_id,data:i,urlname:o,tags:s,anticsrf:e._anticsrf,q:q,q_md5:q_md5},function(t){$("#diaporama_edit_loading").hide();$("#diaporama_edit input").removeAttr("disabled");$("#diaporama_edit textarea").removeAttr("disabled");switch(t.status){case"nochange":$("#diaporama_edit .message").hide();break;case"success":r();e._getImages(false);break;case"warning":n(t.msg);break;case"error":e._alertError(t.msg);break}},"json")})};this._downloadImage=function(){var e=this;$("#diaporama_icon_download").click(function(){window.location=gallery_path+"/download.php?img="+e._images[e._currentPosition].image_id})};this._favoritesBasketEvents=function(){var e=this;var t=["fav","basket"];for(var n=0;n<t.length;n++){$("#diaporama_icon_"+t[n]).click(function(){if(e._images[e._currentPosition]===undefined){return}var t=$(this).attr("id");var n=t.match(/fav$/)?"fav":"basket";var r=$("#diaporama_icon_"+n+" img").attr("src").match(/-active/)?"-remove":"-add";$.post(gallery_path+"/ajax.php",{anticsrf:e._anticsrf,section:(t.match(/fav$/)?"favorites":"basket")+r,images_id:e._images[e._currentPosition].image_id,q:q,q_md5:q_md5},function(n){if(n==null){return}switch(n.status){case"error":e._alertError(n.msg);break;case"full":alert(n.msg);break;case"success":var r=t.match(/basket$/)&&e._q.match(/^basket/)||t.match(/fav$/)&&e._q.match(/^user-favorites/)?false:true;e._getImages(false,r);break}},"json")})}};this._getCarousel=function(e){if(!this.carousel){return}var t=this;var n=e?this._q.replace(/\d+$/,e):this._q;this._carouselCurrentPosition=e?e:this._currentPosition;$.post(gallery_path+"/ajax.php?q="+n,{section:"carousel",size:this.carouselThumbsSize},function(e){if(typeof e!="object"||e===null){return}switch(e.status){case"error":t._alertError(e.msg);break;case"no_result":break;default:t._carouselImages=e.images;if(e.nb_images!=t.nbImages){$("#diaporama_carousel_thumbs").empty()}if(t._carouselImages[t._carouselCurrentPosition]===undefined&&e.nb_images>0){t._reload(e.nb_images);break}t.nbImages=e.nb_images;t._changeCarouselImages();break}},"json")};this._getCarouselStart=function(){var e=Math.floor(this._carouselMaxThumbs)-1;return(Math.ceil(this._carouselCurrentPosition/e)-1)*e+1};this._changeCarouselCurrent=function(){if(!this.carousel){return}$("#diaporama_carousel_thumbs dl").removeClass("current");$("#diaporama_carousel_image_"+this._currentPosition).addClass("current")};this._changeCarouselImages=function(e){if(this._carouselImages===undefined){return}if(this._currentPosition>=this._carouselMaxPosition){var t,n,r,i="",s=0,o=this;var u=Math.floor(this._carouselMaxThumbs)-1;var a=Math.ceil(this._carouselMaxThumbs);var f=this._getCarouselStart();if(f==this._nbImages){f-=u;if(f<1){f=1}}if(!this.animate){e=false}if(e){this._carouselAnimation=true;this._carouselCurrentPosition=f;var l=this._getDiaporamaSize();var c=u*(this.carouselThumbsSize+this.carouselThumbsBorder*2+this.carouselThumbsMargin);if(e=="prev"){$("#diaporama_carousel_thumbs dl:gt("+(a-u)+")").addClass("old")}else{$("#diaporama_carousel_thumbs dl:lt("+u+")").addClass("old")}}else{var h=$("#diaporama_carousel_thumbs dl").length?parseInt($("#diaporama_carousel_thumbs dl:first").attr("id").replace(/diaporama_carousel_image_(\d+)/,"$1")):f;if(h!=f){$("#diaporama_carousel_thumbs").empty()}}for(p in this._carouselImages){if(p<f||$("#diaporama_carousel_image_"+p).is("dl")){continue}if(e=="prev"&&s==u){break}s++;n=this.carouselThumbsSize;r=this.carouselThumbsSize;t=this._carouselImages[p].thumb_center;i+='<dl id="diaporama_carousel_image_'+p+'"><dt style="width:'+n+'px"><a rel="'+s+'" class="thumb_link" style="width:'+n+"px;height:"+r+'px;"><img width="'+this._carouselImages[p].thumb_width+'" height="'+this._carouselImages[p].thumb_height+'" style="padding:'+this._carouselImages[p].thumb_center+'" src="'+this._carouselImages[p].thumb_src+'" /></a></dt></dl>'+"\n";this._carouselMaxPosition=p;if(s==a){break}}if(e=="prev"){$("#diaporama_carousel_thumbs").css({"margin-left":"-"+c+"px"}).prepend(i)}else if(i!==""){$("#diaporama_carousel_thumbs").append(i)}if(e){var d=e=="prev"?{"margin-left":0}:{"margin-left":"-"+c+"px"};$("#diaporama_carousel_thumbs").animate(d,this.carouselNavDuration,"swing",function(){$("#diaporama_carousel_thumbs dl.old").remove();$("#diaporama_carousel_thumbs").css("margin-left",0);o._getCarousel(o._carouselCurrentPosition);o._carouselAnimation=false})}$("#diaporama_carousel_thumbs dl").click(function(){var e=parseInt($(this).attr("id").replace(/diaporama_carousel_image_(\d+)/,"$1"));var t=o._nbImages;if(e==o._currentPosition){return}o._reload(e);o._changeCarouselCurrent();if(o._getCarouselStart()==t){return}if($(this).find("a").attr("rel")>=Math.floor(o._carouselMaxThumbs)){o._carouselMaxPosition=0;o._getCarousel()}});this._changeCarouselPages()}if(!e){this._changeCarouselCurrent()}};this._changeCarouselPages=function(){var e=this;var t=Math.floor(this._carouselMaxThumbs)-1;this._carouselCurrentPage=Math.ceil(this._carouselCurrentPosition/t);this._carouselNbPages=Math.ceil((this._nbImages-1)/t);if(this._carouselCurrentPage>1){$("#diaporama_carousel_prev a").addClass("active").unbind().click(function(){if(e._carouselAnimation){return}var t=$("#diaporama_carousel_thumbs dl:first").attr("id");if(!t){return}var n=parseInt(t.replace(/diaporama_carousel_image_/,""))-1;e._carouselMaxPosition=0;e._carouselCurrentPosition=n;e._changeCarouselImages("prev")})}else{$("#diaporama_carousel_prev a").removeAttr("href").unbind().removeClass()}if(this._carouselCurrentPage<this._carouselNbPages){$("#diaporama_carousel_next a").addClass("active").unbind().click(function(){if(e._carouselAnimation){return}var t=Math.floor(e._carouselMaxThumbs)-1;var n=$("#diaporama_carousel_thumbs dl:eq("+t+")").attr("id");if(!n){return}var r=parseInt(n.replace(/diaporama_carousel_image_/,""));e._carouselMaxPosition=0;e._carouselCurrentPosition=r;e._changeCarouselImages("next")})}else{$("#diaporama_carousel_next a").removeAttr("href").unbind().removeClass()}};this._changeCarouselSizePosition=function(e){var t=this;var n=this._getDiaporamaSize();n.availableWidth+=e?e:0;var r={left:n.availableWidth-$("#diaporama_carousel_prev").outerWidth()+"px"};var i=function(){t._carouselMaxThumbs=(n.availableWidth-$("#diaporama_carousel_prev").outerWidth()*2-t.carouselThumbsMargin)/(t.carouselThumbsSize+t.carouselThumbsBorder*2+t.carouselThumbsMargin);t._carouselMaxPosition=0;t._changeCarouselImages()};var s=this.carouselThumbsMargin*2+this.carouselThumbsBorder*2+this.carouselBorderTop;$("#diaporama_carousel").css({height:this.carouselThumbsSize+s+"px"});if(e&&this.animate){$("#diaporama_carousel_next").animate(r,this.sidebarShowDuration,function(){i()})}else{$("#diaporama_carousel_next").css(r);i()}};this._getDiaporamaSize=function(){var e={barBottomHeight:0,barTopHeight:0,carouselHeight:0,sidebarWidth:0,imageBorderHeight:0,imageBorderWidth:0};if(this.sidebarImageResize&&$(".diaporama_sidebar").is(":visible")){e.sidebarWidth=$(".diaporama_sidebar").outerWidth()}if(this.carousel&&!this.hideControlBars){e.carouselHeight=$("#diaporama_carousel").outerHeight()}if(!this.hideControlBars){e.barTopHeight=$("#diaporama_top").outerHeight();e.barBottomHeight=$("#diaporama_bottom").outerHeight()}e.imageBorderHeight=parseInt($("#diaporama_image_"+this._currentPosition).css("borderTopWidth"))+parseInt($("#diaporama_image_"+this._currentPosition).css("borderBottomWidth"));e.imageBorderWidth=parseInt($("#diaporama_image_"+this._currentPosition).css("borderLeftWidth"))+parseInt($("#diaporama_image_"+this._currentPosition).css("borderRightWidth"));if(isNaN(e.imageBorderHeight)){e.imageBorderHeight=0}if(isNaN(e.imageBorderWidth)){e.imageBorderWidth=0}e.availableHeight=$(window).height()-e.barTopHeight-e.barBottomHeight-e.carouselHeight-e.imageBorderHeight;e.availableWidth=$(window).width()-e.sidebarWidth-e.imageBorderWidth;return e};this._getImages=function(first,only_image_infos){var This=this;if(first){$("#diaporama_loading").css("visibility","visible")}$.post(gallery_path+"/ajax.php?q="+this._q,{section:"diaporama",first:first?1:0,preload:this.preload},function(r){if(typeof r!="object"||r===null){return}switch(r.status){case"error":This._alertError(r.msg);break;case"no_result":break;default:var reload=false;if(only_image_infos){This._images=r.images;This._changeImageInfos();break}if(r.nb_images==0){$("#diaporama_top_left,"+"#diaporama_image_position,"+".diaporama_sidebar_inner").empty();$("#diaporama_icon_switch").removeAttr("href");$("#diaporama_icon_switch img").attr("src",$("#diaporama_icon_switch img").attr("src").replace(/(no)?resize(-grey)?\.png$/,"resize-grey.png")).css({cursor:"default"});$("#diaporama_icon_fav img").attr("src",$("#diaporama_icon_fav img").attr("src").replace(/fav(-active)?.png$/,"fav.png"));$("#diaporama_icon_basket img").attr("src",$("#diaporama_icon_basket img").attr("src").replace(/basket(-active)?.png$/,"basket.png"));This._carouselImages=undefined;$("#diaporama_carousel_thumbs").empty();$("#diaporama_carousel_prev a,#diaporama_carousel_next a").removeAttr("href").unbind().removeClass()}for(p in r.images){if(This._images[p]===undefined||This._images[p].md5==r.images[p].md5){continue}if(This._currentPosition>r.nb_images){This._currentPosition=r.nb_images}This._deleteImages(true);reload=true;break}This._anticsrf=r.anticsrf;This._images=r.images;This._nbImages=r.nb_images;if(first&&r.max_user_connections==0&&This.createImageTempTime!=0){This.createImageTempTime=50}var i=1;var temp_autostart=1;for(p in This._images){var visible=p==This._currentPosition;if(!first&&!reload&&visible){continue}if(first||reload){if(visible){This._changeImageInfos();This._createImage(p);This._changeImageSizePosition(p,false,visible);temp_autostart=i}else{eval("var create_"+p+" = function(){"+"This._createImage("+p+");"+"This._changeImageSizePosition("+p+", false, "+visible+");};"+"setTimeout(create_"+p+", "+This.createImageTempTime+" * i);");i++}}else{This._createImage(p);This._changeImageSizePosition(p,false,visible)}}if(first||reload){setTimeout(function(){This._changeNavigationButtons()},This.createImageTempTime*temp_autostart)}else{This._changeNavigationButtons()}if(reload){$("#diaporama_carousel_thumbs").empty()}This._deleteImages();if(first&&This.autoStart){setTimeout(function(){$("#diaporama_icon_start").trigger("click")},This.createImageTempTime*temp_autostart)}This._changeImageInfos();This._carouselMaxPosition=0;This._getCarousel(This._currentPosition);break}},"json")};this._getPrefs=function(){if(typeof diaporama_prefs!="object"){return}for(name in diaporama_prefs){this[name]=diaporama_prefs[name]}};this._imageMouseDown=function(){var e=this;var t=$("#diaporama_image_"+this._currentPosition);t.unbind("mousedown");if($("#diaporama_icon_switch img").attr("src").match(/noresize\.png$/)){t.css({cursor:"move"}).mousedown(function(t){return e._dragImage(this,t)})}else{t.css({cursor:"default"})}};this._isSidebarVisible=function(){var e=false;$(".diaporama_sidebar").each(function(){if($(this).is(":visible")){e=true;return}});return e};this._keyboard=function(){if(!this.keyboardNav){return}var e=this;$("#diaporama select, #diaporama input, #diaporama textarea").focus(function(){e._keyboardActive=false}).blur(function(){e._keyboardActive=true});$(document).keyup(function(t){if(!e._keyboardActive){return}switch(t.keyCode){case 27:$("#diaporama_icon_close").trigger("click");break;case 32:if($("#diaporama_icon_stop img").attr("src").match(/stop-active\.png$/)){$("#diaporama_icon_start").trigger("click")}else{$("#diaporama_icon_stop").trigger("click")}break;case 37:$("#diaporama_icon_prev").trigger("click");break;case 39:$("#diaporama_icon_next").trigger("click");break}});$(document).keydown(function(t){if(!e._keyboardActive){return}switch(t.keyCode){case 38:e._autoDurationMouseDown=true;e._autoChangeDuration(e.autoDurationPrecision);e._autoDurationMouseDown=false;break;case 40:e._autoDurationMouseDown=true;e._autoChangeDuration(-e.autoDurationPrecision);e._autoDurationMouseDown=false;break}})};this._options=function(){var e=this;this._getPrefs();$("#diaporama_carousel_option").click(function(){e.carousel=!e.carousel;if(e.carousel){e._getCarousel();$("#diaporama_carousel").show();e._changeCarouselSizePosition()}else{$("#diaporama_carousel").hide()}e._changeImageSizePosition(e._currentPosition);e._prevDiaporamaSize=e._getDiaporamaSize();e._savePrefs()});if(this.carousel){$("#diaporama_carousel_option").attr("checked","checked");$("#diaporama_carousel").show()}else{$("#diaporama_carousel_option").removeAttr("checked");$("#diaporama_carousel").hide()}this.carouselThumbsSize=this.carouselThumbsSize<50?50:this.carouselThumbsSize;$("#diaporama_transitions_effect").change(function(){e.transitionEffect=$("#diaporama_transitions_effect option:selected").val();e._savePrefs()});$("#diaporama_transitions_effect option[value="+this.transitionEffect+"]").attr("selected","selected");$("#diaporama_transitions_duration").keyup(function(){e.transitionDuration=$("#diaporama_transitions_duration").val();e._savePrefs()});$("#diaporama_transitions_duration").val(this.transitionDuration);$("#diaporama_autoloop").click(function(){e.autoLoop=!e.autoLoop;if(e._currentPosition==e._nbImages&&!e.autoLoop){$("#diaporama_icon_stop").trigger("click")}e._savePrefs()});if(this.autoLoop){$("#diaporama_autoloop").attr("checked","checked")}else{$("#diaporama_autoloop").removeAttr("checked")}$("#diaporama_hidebars").click(function(){e.hideControlBars=!e.hideControlBars;e._changeImageSizePosition(e._currentPosition);e._savePrefs()});if(this.hideControlBars){$("#diaporama_hidebars").attr("checked","checked")}else{$("#diaporama_hidebars").removeAttr("checked")}$("#diaporama_animate").click(function(){e.animate=!e.animate;e._savePrefs()});if(this.animate){$("#diaporama_animate").attr("checked","checked")}else{$("#diaporama_animate").removeAttr("checked")}};this._reload=function(e){this._q=this._q.replace(/position\/\d+$/,"position/"+e);this._currentPosition=e;this._images={};this._nbImages=0;this._realsize=false;this._changeNavigationButtons();this._deleteImages(true);this._getImages(true,false)};this._resize=function(){this._changeDiaporamaSize();if(this._images[this._currentPosition]!==undefined){this._changeImageSizePosition(this._currentPosition)}this._prevDiaporamaSize=this._getDiaporamaSize()};this._savePrefs=function(){var e=this.animate+","+this.autoDuration+","+this.autoLoop+","+this.carousel+","+this.hideControlBars+","+this.transitionDuration+","+this.transitionEffect;$.post(gallery_path+"/ajax.php",{section:"prefs",cookie_param:"diaporama",cookie_value:e})};this._sidebarsEvents=function(){var e=this;var t="#diaporama_top_right .diaporama_icon_sidebar";$(t).each(function(){var n="#"+$(this).attr("id");var r=n.replace(/_icon/,"");$(n).click(function(){if(e._sidebarMoveLock||e._imageTransitionLock){return}e._sidebarMoveLock=true;var i=e.sidebarImageResize?$(".diaporama_sidebar").outerWidth():0;if($(r).is(":hidden")){var s=false;var o=function(){var t=e._changeImageSizePosition(e._currentPosition,true,true,true,-i);var s=function(){e._prevDiaporamaSize=e._getDiaporamaSize();e._changeSwitchButton();e._sidebarMoveLock=false;$(r).find("p:visible .diaporama_focus:not(:disabled)").focus()};e._changeCarouselSizePosition(-i);if(e.sidebarShowDuration&&e.animate){$("#diaporama_image_"+e._currentPosition).animate(t,e.sidebarShowDuration);$(r).show("slide",{direction:"right"},e.sidebarShowDuration,s)}else{$("#diaporama_image_"+e._currentPosition).css(t);$(r).show();s()}$(n+" img").attr("src",$(n+" img").attr("src").replace(/\.png$/,"-active.png"))};$(t).each(function(){var t="#"+$(this).attr("id").replace(/_icon/,"");if($(t).is(":visible")){$(this).find("img").attr("src",$(this).find("img").attr("src").replace(/-active\.png$/,".png"));if(e.sidebarShowDuration&&e.animate){$(t).hide("slide",{direction:"right"},e.sidebarShowDuration,o)}else{$(t).hide();o()}s=true}});if(!s){o()}}else{var u=e._changeImageSizePosition(e._currentPosition,true,true,true,i);var a=function(){e._prevDiaporamaSize=e._getDiaporamaSize();e._changeSwitchButton();e._sidebarMoveLock=false};e._changeCarouselSizePosition(i);if(e.sidebarShowDuration&&e.animate){$("#diaporama_image_"+e._currentPosition).animate(u,e.sidebarShowDuration);$(r).hide("slide",{direction:"right"},e.sidebarShowDuration,a)}else{$("#diaporama_image_"+e._currentPosition).css(u);$(r).hide();a()}$(n+" img").attr("src",$(n+" img").attr("src").replace(/-active\.png$/,".png"));$(n).focus()}})});$(".diaporama_sidebar_close").click(function(){var e="#"+$(this).parents("div").attr("id").replace(/diaporama/,"diaporama_icon");$(e).trigger("click")});$(".diaporama_sidebar_title2 span").click(function(){var e=$(this).parents("li").find(".diaporama_sidebar_content");if(e.is(":hidden")){e.slideDown("fast")}else{e.slideUp("fast")}})};this._transition=function(e,t,n){var r=this;var i=this._getDiaporamaSize();var s=$("#diaporama_image_"+e).offset();var o=parseInt(this.transitionDuration);var u=this.transitionEffect;this._imageTransitionLock=true;if(this.transitionEffect=="random"){var a=$("#diaporama_transitions_effect option").length-2;var f=Math.floor(Math.random()*a)+1;u=document.getElementById("diaporama_transitions_effect").getElementsByTagName("option")[f].value}switch(u){case"fade":$("#diaporama_image_"+e).fadeOut(o);$("#diaporama_image_"+t).fadeIn(o);break;case"slideX":case"slideY":var l={};var c={display:"none"};if(u=="slideX"){l.left=n=="next"||n=="last"?s.left-i.availableWidth+"px":s.left+i.availableWidth+"px";c.left=s.left+"px"}else{l.top=n=="next"||n=="last"?s.top+i.availableHeight+"px":s.top-i.availableHeight+"px";c.top=s.top+"px"}$("#diaporama_image_"+e).animate(l,o,"swing",function(){$("#diaporama_image_"+e).css(c)});var h={display:"block"};var p={};if(u=="slideX"){var d=$("#diaporama_image_"+t).css("left");p.left=d;h.left=n=="next"||n=="last"?parseFloat(d)+i.availableWidth+"px":parseFloat(d)-i.availableWidth+"px"}else{var v=$("#diaporama_image_"+t).css("top");p.top=v;h.top=n=="next"||n=="last"?parseFloat(v)-i.availableHeight+"px":parseFloat(v)+i.availableHeight+"px"}$("#diaporama_image_"+t).css(h).animate(p,o,"swing");break;case"slideXLeft":case"slideYBottom":var l={};var c={display:"none"};if(u=="slideXLeft"){l.left=s.left-i.availableWidth+"px";c.left=s.left+"px"}else{l.top=s.top+i.availableHeight+"px";c.top=s.top+"px"}$("#diaporama_image_"+e).animate(l,o/2,"swing",function(){$("#diaporama_image_"+e).css(c);var n={display:"block"};var r={};if(u=="slideXLeft"){var s=$("#diaporama_image_"+t).css("left");r.left=s;n.left=-(parseFloat(s)+i.availableWidth)+"px"}else{var a=$("#diaporama_image_"+t).css("top");r.top=a;n.top=-(parseFloat(a)-i.availableHeight)+"px"}$("#diaporama_image_"+t).css(n).animate(r,o/2,"swing")});break;case"zoom":case"curtainX":case"curtainY":var l={};var c={display:"none"};if(u!="curtainX"){l.height=0;l.top=i.availableHeight/2;c.top=s.top+"px"}if(u!="curtainY"){l.width=0;l.left=i.availableWidth/2;c.left=s.left+"px"}$("#diaporama_image_"+e).animate(l,o/2,"swing",function(){$("#diaporama_image_"+e).css(c);var n={display:"block"};var r={};if(u!="curtainX"){r.height=$("#diaporama_image_"+t).height();r.top=$("#diaporama_image_"+t).css("top");n.top=i.availableHeight/2;n.height=0}if(u!="curtainY"){r.width=$("#diaporama_image_"+t).width();r.left=$("#diaporama_image_"+t).css("left");n.left=i.availableWidth/2;n.width=0}$("#diaporama_image_"+t).css(n).animate(r,o/2,"swing")});break;case"puff":var l={};var c={display:"none",opacity:1};l.height=$("#diaporama_image_"+e).height()*1.5;l.width=$("#diaporama_image_"+e).width()*1.5;l.left=(i.availableWidth-l.width)/2;l.top=(i.availableHeight-l.height)/2+i.barTopHeight;l.opacity=0;$("#diaporama_image_"+e).animate(l,o/2,"swing",function(){$("#diaporama_image_"+e).css(c);var n={display:"block"};n.height=$("#diaporama_image_"+t).height()*1.5;n.width=$("#diaporama_image_"+t).width()*1.5;n.left=(i.availableWidth-n.width)/2;n.top=(i.availableHeight-n.height)/2+i.barTopHeight;n.opacity=0;var s=r._changeImageSizePosition(t,true,true,true);s.opacity=1;$("#diaporama_image_"+t).css(n).animate(s,o/2,"swing")});break;default:$("#diaporama_image_"+e).hide();$("#diaporama_image_"+t).show();o=0;break}setTimeout(function(){r._changeImageInfos();r._imageTransitionLock=false},o)}
};